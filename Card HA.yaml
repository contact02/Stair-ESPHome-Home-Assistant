type: vertical-stack
cards:
  - type: custom:mushroom-title-card
    title: Сходи 2 поверх
    subtitle: Налаштування параметрів
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        entity: select.skhodi_2_poverkh_stairs_current_mode
        name: Біжуча сходинка
        label: Ефект
        show_label: true
        icon: mdi:stairs
        styles:
          card:
            - height: 90px
            - border-radius: 14px
            - display: flex
            - flex-direction: column
            - justify-content: center
            - align-items: center
            - background-color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Stairs Steps' ? `rgba(${r}, ${g}, ${b}, 0.15)` : 'var(--card-background-color)';
                ]]]
            - border: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Stairs Steps' ? `1px solid rgba(${r}, ${g}, ${b}, 0.5)` : '1px solid var(--divider-color)';
                ]]]
          icon:
            - width: 30px
            - color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Stairs Steps' ? `rgb(${r}, ${g}, ${b})` : 'var(--disabled-text-color)';
                ]]]
            - animation: >
                [[[ return entity.state === 'Stairs Steps' ? 'pulse 3s
                ease-in-out infinite' : 'none'; ]]]
          name:
            - font-size: 11px
            - font-weight: bold
            - margin-top: 4px
          label:
            - font-size: 9px
            - filter: opacity(0.7)
        extra_styles: |
          @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
          }
        tap_action:
          action: call-service
          service: select.select_option
          service_data:
            entity_id: select.skhodi_2_poverkh_stairs_current_mode
            option: Stairs Steps
      - type: custom:button-card
        entity: select.skhodi_2_poverkh_stairs_current_mode
        name: Один колір
        label: Постійне
        show_label: true
        icon: mdi:lightbulb-outline
        styles:
          card:
            - height: 90px
            - border-radius: 14px
            - display: flex
            - flex-direction: column
            - justify-content: center
            - align-items: center
            - background-color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Static' ? `rgba(${r}, ${g}, ${b}, 0.15)` : 'var(--card-background-color)';
                ]]]
            - border: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Static' ? `1px solid rgba(${r}, ${g}, ${b}, 0.5)` : '1px solid var(--divider-color)';
                ]]]
          icon:
            - width: 30px
            - color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Static' ? `rgb(${r}, ${g}, ${b})` : 'var(--disabled-text-color)';
                ]]]
            - animation: >
                [[[ return entity.state === 'Static' ? 'pulse 3s ease-in-out
                infinite' : 'none'; ]]]
          name:
            - font-size: 11px
            - font-weight: bold
            - margin-top: 4px
          label:
            - font-size: 9px
            - filter: opacity(0.7)
        extra_styles: |
          @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
          }
        tap_action:
          action: call-service
          service: select.select_option
          service_data:
            entity_id: select.skhodi_2_poverkh_stairs_current_mode
            option: Static
      - type: custom:button-card
        entity: select.skhodi_2_poverkh_stairs_current_mode
        name: Веселка
        label: Кольори
        show_label: true
        icon: mdi:looks
        styles:
          card:
            - height: 90px
            - border-radius: 14px
            - display: flex
            - flex-direction: column
            - justify-content: center
            - align-items: center
            - background-color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Rainbow' ? `rgba(${r}, ${g}, ${b}, 0.15)` : 'var(--card-background-color)';
                ]]]
            - border: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Rainbow' ? `1px solid rgba(${r}, ${g}, ${b}, 0.5)` : '1px solid var(--divider-color)';
                ]]]
          icon:
            - width: 30px
            - color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return entity.state === 'Rainbow' ? `rgb(${r}, ${g}, ${b})` : 'var(--disabled-text-color)';
                ]]]
            - animation: >
                [[[ return entity.state === 'Rainbow' ? 'pulse 3s ease-in-out
                infinite' : 'none'; ]]]
          name:
            - font-size: 11px
            - font-weight: bold
            - margin-top: 4px
          label:
            - font-size: 9px
            - filter: opacity(0.7)
        extra_styles: |
          @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
          }
        tap_action:
          action: call-service
          service: select.select_option
          service_data:
            entity_id: select.skhodi_2_poverkh_stairs_current_mode
            option: Rainbow
  - type: custom:mushroom-light-card
    entity: light.skhodi_2_poverkh_stairs_main_light
    use_light_color: true
    show_brightness_control: false
    show_color_control: true
    collapsible_controls: true
    name: Вибір кольору
    icon: mdi:palette
  - type: custom:mushroom-number-card
    entity: number.skhodi_2_poverkh_stairs_max_brightness
    name: Яскравість
    icon: mdi:brightness-6
    card_mod:
      style: |
        ha-card {
          --rgb-orange: {{ (states('sensor.skhodi_2_poverkh_stairs_saved_red') | float * 255) | round }},
                        {{ (states('sensor.skhodi_2_poverkh_stairs_saved_green') | float * 255) | round }},
                        {{ (states('sensor.skhodi_2_poverkh_stairs_saved_blue') | float * 255) | round }};
          --icon-color: rgb(var(--rgb-orange)) !important;
          --control-base-color: rgb(var(--rgb-orange)) !important;
          --control-color: rgb(var(--rgb-orange)) !important;
        }
    icon_color: orange
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-number-card
        entity: number.skhodi_2_poverkh_stairs_speed
        name: Швидкість (мс)
        icon: mdi:speedometer
        icon_color: amber
        card_mod:
          style: |
            ha-card {
              --rgb-amber: {{ (states('sensor.skhodi_2_poverkh_stairs_saved_red') | float * 255) | round }},
                           {{ (states('sensor.skhodi_2_poverkh_stairs_saved_green') | float * 255) | round }},
                           {{ (states('sensor.skhodi_2_poverkh_stairs_saved_blue') | float * 255) | round }};
              --icon-color: rgb(var(--rgb-amber)) !important;
              --control-color: rgb(var(--rgb-amber)) !important;
              --control-base-color: rgba(var(--rgb-amber), 0.2) !important;
            }
      - type: custom:mushroom-number-card
        entity: number.skhodi_2_poverkh_stairs_timeout
        name: Час очікування (сек)
        icon: mdi:timer-sand
        icon_color: amber
        card_mod:
          style: |
            ha-card {
              --rgb-amber: {{ (states('sensor.skhodi_2_poverkh_stairs_saved_red') | float * 255) | round }},
                           {{ (states('sensor.skhodi_2_poverkh_stairs_saved_green') | float * 255) | round }},
                           {{ (states('sensor.skhodi_2_poverkh_stairs_saved_blue') | float * 255) | round }};
              --control-color: rgb(var(--rgb-amber)) !important;
              --control-base-color: rgba(var(--rgb-amber), 0.2) !important;
            }
  - type: horizontal-stack
    cards:
      - type: custom:mushroom-entity-card
        entity: binary_sensor.skhodi_2_poverkh_stairs_sensor_top
        name: Сенсор Вгорі
        icon: mdi:stairs-down
        icon_color: blue
        card_mod:
          style: |
            ha-card {
              --rgb-blue: {{ (states('sensor.skhodi_2_poverkh_stairs_saved_red') | float * 255) | round }},
                          {{ (states('sensor.skhodi_2_poverkh_stairs_saved_green') | float * 255) | round }},
                          {{ (states('sensor.skhodi_2_poverkh_stairs_saved_blue') | float * 255) | round }};
            }
      - type: custom:mushroom-entity-card
        entity: binary_sensor.skhodi_2_poverkh_stairs_sensor_bottom
        name: Сенсор Внизу
        icon: mdi:stairs-up
        icon_color: blue
        card_mod:
          style: |
            ha-card {
              --rgb-blue: {{ (states('sensor.skhodi_2_poverkh_stairs_saved_red') | float * 255) | round }},
                          {{ (states('sensor.skhodi_2_poverkh_stairs_saved_green') | float * 255) | round }},
                          {{ (states('sensor.skhodi_2_poverkh_stairs_saved_blue') | float * 255) | round }};
            }
  - type: horizontal-stack
    cards:
      - type: custom:button-card
        entity: button.skhodi_2_poverkh_stairs_save_color
        name: Записати
        icon: mdi:content-save-check
        styles:
          card:
            - height: 90px
            - border-radius: 14px
            - display: flex
            - flex-direction: column
            - justify-content: center
            - align-items: center
            - background-color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  return `rgb(${r}, ${g}, ${b})`;
                ]]]
          icon:
            - width: 28px
            - color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  const brightness = (r * 299 + g * 587 + b * 114) / 1000;
                  return brightness > 125 ? 'rgba(0,0,0,0.8)' : 'white';
                ]]]
            - animation: pulse 3s ease-in-out infinite
          name:
            - font-size: 11px
            - font-weight: bold
            - margin-top: 4px
            - text-transform: uppercase
            - color: |
                [[[
                  const r = (states['sensor.skhodi_2_poverkh_stairs_saved_red']?.state || 0) * 255;
                  const g = (states['sensor.skhodi_2_poverkh_stairs_saved_green']?.state || 0) * 255;
                  const b = (states['sensor.skhodi_2_poverkh_stairs_saved_blue']?.state || 0) * 255;
                  const brightness = (r * 299 + g * 587 + b * 114) / 1000;
                  return brightness > 125 ? 'black' : 'white';
                ]]]
        extra_styles: |
          @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.4; }
            100% { opacity: 1; }
          }
        tap_action:
          action: toggle
      - type: custom:button-card
        entity: button.skhodi_2_poverkh_stairs_reset_settings
        name: Скинути
        icon: mdi:factory
        styles:
          card:
            - height: 90px
            - border-radius: 14px
            - display: flex
            - flex-direction: column
            - justify-content: center
            - align-items: center
            - background-color: rgba(244, 67, 54, 0.1)
            - border: 1px solid rgba(244, 67, 54, 0.3)
          icon:
            - width: 28px
            - color: rgb(244, 67, 54)
          name:
            - font-size: 11px
            - font-weight: bold
            - margin-top: 4px
            - color: var(--primary-text-color)
        tap_action:
          action: toggle
          confirmation:
            text: Ви впевнені, що хочете скинути налаштування?
      - type: custom:button-card
        entity: button.skhodi_2_poverkh_stairs_restart_device
        name: Перезапуск
        icon: mdi:restart
        styles:
          card:
            - height: 90px
            - border-radius: 14px
            - display: flex
            - flex-direction: column
            - justify-content: center
            - align-items: center
            - background-color: rgba(255, 152, 0, 0.1)
            - border: 1px solid rgba(255, 152, 0, 0.3)
          icon:
            - width: 28px
            - color: rgb(255, 152, 0)
          name:
            - font-size: 11px
            - font-weight: bold
            - margin-top: 4px
            - color: var(--primary-text-color)
        tap_action:
          action: toggle
